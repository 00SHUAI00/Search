# 文档搜索系统 - 项目概览

## 🎯 项目功能

### 核心功能模块

```
📁 智能文档搜索系统
├── 📤 文档上传模块
│   ├── 支持 PDF、Word、TXT 格式
│   ├── 文件类型和大小验证 (50MB)
│   ├── 自动去重文件名处理
│   ├── 结构化内容解析
│   └── 数据库事务存储
│
├── 🔍 高级搜索引擎模块  
│   ├── SQLite FTS5 全文搜索
│   ├── 严格"与"搜索逻辑
│   ├── 双重过滤相关度算法
│   ├── 词边界匹配验证
│   ├── 清空搜索功能
│   └── 匹配词高亮显示
│
├── 📊 文档管理模块
│   ├── 文档列表展示（可滚动）
│   ├── 结构化主题概览
│   ├── 删除功能（级联删除）
│   ├── 上传时间和统计信息
│   └── 实时状态更新
│
├── �️ 结构化解析模块
│   ├── Word文档Heading2识别
│   ├── Markdown标题解析(##)
│   ├── 表情符号主题标记🌐🔍🏗️🧭📆🗂️
│   ├── HTML到Markdown转换
│   └── 段落内容提取
│
└── 🎨 响应式用户界面
    ├── 标签页导航系统
    ├── 可滚动长内容容器
    ├── 实时搜索反馈
    ├── 文件上传进度显示
    └── 移动端适配
```

## 🏗️ 技术架构

### 前端架构
```
React Components (TypeScript + Tailwind)
├── UploadComponent - 文档上传界面
├── SearchComponent - 搜索功能界面（支持清空）
├── DocumentList - 文档列表界面（支持删除+滚动）
└── UI Components - 基础UI组件
    ├── Button, Input, Card
    ├── 响应式布局设计
    └── 可滚动容器组件
```

### 后端架构
```
Next.js API Routes + SQLite
├── /api/upload - 文档上传和解析处理
├── /api/search - 高级搜索API（双重过滤）
├── /api/documents - 文档CRUD操作（获取/删除）
│   └── /api/documents/[id] - 删除特定文档
└── 核心库模块
    ├── database.ts - SQLite数据库操作（ACID事务）
    ├── documentParser.ts - 结构化文档解析
    └── searchEngine.ts - 高级搜索算法

SQLite Database (better-sqlite3)
├── documents 表 - 文档基本信息（外键约束）
├── topics 表 - 结构化主题内容（级联删除）
└── search_index (FTS5) - 全文搜索索引（优化配置）
```

### 数据流程
```
1. 文档上传流程:
   文件选择 → 类型验证 → 上传处理 → 格式解析 → 结构化提取 → 事务存储 → 索引构建

2. 搜索查询流程:
   关键词输入 → 分词处理 → FTS5查询 → 相关度计算 → 双重过滤 → 结果排序 → 高亮显示

3. 文档管理流程:
   列表展示 → 统计信息 → 删除操作 → 级联清理 → 索引更新 → 状态同步
```

## 🔧 核心算法

### 结构化解析算法
```javascript
// 支持的主题标记模式
const PATTERNS = {
  markdown: /^##\s+(.+)$/,           // ## 标题
  emoji: /^[🌐🔍🏗️🧭📆🗂️]\s*(.+)$/,    // 表情符号主题
  heading2: /<h2[^>]*>(.*?)<\/h2>/gi  // Word Heading2
}

// 解析流程
1. Word文档 → mammoth → HTML → 清理标签 → Markdown转换
2. 逐行扫描 → 模式匹配 → 主题提取 → 内容聚合
3. 验证 → 去重 → 结构化存储
```

### 高级搜索算法
```javascript
// 双重过滤机制
const searchFlow = {
  step1: "FTS5基础搜索 → 初步结果集",
  step2: "词边界验证 → 精确匹配过滤", 
  step3: "相关度计算 → 权重评分",
  step4: "阈值过滤 → 高质量结果",
  step5: "排序 → 用户展示"
}

// 相关度权重
titleMatch: 2.0    // 标题匹配权重
contentMatch: 1.0  // 内容匹配权重
threshold: 1.0     // 最低相关度阈值
```

3. 文档浏览流程:
   用户访问文档库 → 查询数据库 → 获取文档列表 → 展示主题概览
```

## 📋 功能特性清单

### ✅ 已实现功能

- [x] 📤 多格式文档上传 (PDF, DOCX, TXT)
- [x] 🔍 高级全文搜索引擎 (SQLite FTS5)
- [x] 🎯 严格"与"搜索逻辑 (双重过滤)
- [x] 📊 智能相关度评分 (词边界+权重)
- [x] 🏷️ 结构化主题提取 (##标题+表情符号)
- [x] 📱 响应式用户界面 (可滚动容器)
- [x] 📋 完整文档管理 (CRUD操作)
- [x] 🗑️ 文档删除功能 (级联删除)
- [x] 🎨 现代化UI设计 (Tailwind CSS)
- [x] 🔒 文件类型安全验证
- [x] ⚡ 实时搜索反馈 (支持清空)
- [x] 💾 数据持久化存储 (SQLite)
- [x] 🔄 事务支持 (ACID保证)
- [x] 📊 Word文档Heading2解析
- [x] 🎛️ 高级搜索过滤算法

### 🔄 可扩展功能

- [ ] 🖼️ 图片内容提取和OCR搜索
- [ ] 📈 搜索历史和使用统计
- [ ] 👥 用户权限和角色管理
- [ ] 🏆 搜索结果导出功能
- [ ] 📱 原生移动端App
- [ ] 🌐 多语言界面支持
- [ ] 🤖 AI驱动的语义搜索
- [ ] 📧 文档更新邮件通知
- [ ] 🔖 文档标签和分类系统
- [ ] 📊 搜索分析仪表盘

## 🚀 快速启动

### 方式一: 使用启动脚本 (推荐)
```bash
# Windows 用户
双击 start.bat 或在命令行运行: start.bat

# Linux/Mac 用户  
chmod +x start.sh && ./start.sh
```

### 方式二: 手动启动
```bash
# 1. 安装依赖
npm install

# 2. 启动开发服务器
npm run dev

```bash
npm install
npm run dev
```

## 📸 系统特性展示

### 🔍 高级搜索特性
- **双重过滤机制**: FTS5基础搜索 + 精确词边界匹配
- **智能相关度评分**: 标题匹配(2.0权重) + 内容匹配(1.0权重)
- **严格AND逻辑**: 确保所有搜索词都匹配，过滤无关结果
- **清空搜索功能**: 空搜索框自动清除结果
- **实时搜索反馈**: 即时响应用户输入

### 📄 结构化文档解析
- **Word文档支持**: mammoth库解析 + Heading2格式识别
- **多种标题模式**: Markdown ## 标题 + 表情符号主题🌐🔍🏗️🧭📆🗂️
- **HTML清理转换**: 自动清理HTML标签并转换为纯文本
- **段落智能聚合**: 相邻内容自动合并为完整段落

### 🗃️ 数据库优化特性
- **事务支持**: ACID保证数据一致性
- **外键约束**: 确保数据关系完整性
- **级联删除**: 删除文档自动清理所有关联数据
- **FTS5索引**: 全文搜索性能优化
- **自动初始化**: 首次运行自动创建数据库表结构

### 🎨 用户体验优化
- **可滚动容器**: 长内容支持滚动查看 (max-h-48, max-h-32)
- **响应式设计**: 完美适配桌面和移动设备
- **实时状态更新**: 上传、删除、搜索实时反馈
- **错误处理**: 完善的错误提示和异常处理
- **加载状态**: 清晰的操作进度指示

## 🔧 开发环境要求

- **Node.js**: 18.0+ (推荐 18.17.0+)
- **npm**: 9.0+ (或 yarn 1.22.0+)
- **操作系统**: Windows 10+, macOS 10.15+, Ubuntu 18.04+
- **浏览器**: Chrome 88+, Firefox 85+, Safari 14+, Edge 88+
- **内存**: 4GB+ RAM (推荐 8GB+)
- **存储**: 2GB+ 可用空间 (包含文档存储)

## 📞 使用指南和故障排除

### 常见问题解决

1. **启动失败**: 
   - 检查Node.js版本: `node --version`
   - 重新安装依赖: `rm -rf node_modules && npm install`

2. **端口占用**: 
   - Windows: `netstat -ano | findstr :3000`
   - Unix: `lsof -i :3000`

3. **上传失败**: 
   - 检查uploads目录权限
   - 确认文件大小 < 50MB
   - 验证文件格式 (PDF/DOCX/TXT)

4. **搜索无结果**: 
   - 确认文档已成功上传并解析
   - 检查数据库文件: `data/documents.db`
   - 尝试不同的搜索关键词

5. **数据库问题**:
   - 删除并重新创建: `rm data/documents.db`
   - 重新上传文档建立索引

### 性能优化建议

- **大文件处理**: 建议单个文件 < 10MB 以获得最佳性能
- **搜索优化**: 使用具体关键词而非通用词汇
- **定期清理**: 删除不需要的文档释放存储空间

---

🎉 **恭喜！您的文档搜索系统已经搭建完成！**

现在您可以开始上传文档并体验强大的搜索功能了。
